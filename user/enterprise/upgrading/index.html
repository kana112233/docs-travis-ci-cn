<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Upgrading Travis CI Enterprise - Travis CI</title>
<link rel="stylesheet" href="/docs-travis-ci-cn/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="https://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>

<script src="/docs-travis-ci-cn/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/docs-travis-ci-cn/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body class="enterprise">
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="https://travis-ci.com/" title="Travis CI">Travis</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">About Travis CI Enterprise</a></li>
        <li><a href="/user/enterprise/setting-up-travis-ci-enterprise/">Setting up Travis CI Enterprise</a> </li>
        <li><a href="/user/enterprise/upgrading/">Upgrading</a></li>
      </ul>

      <h3>Environment reference</h3>
      <ul>
        <li><a href="/user/enterprise/xenial">Xenial Build Environment</a></li>

        <li><a href="/user/enterprise/trusty/">Trusty Build Environment</a></li>

        <li><a href="/user/enterprise/precise/">Precise (Legacy) Build Environment</a></li>
      </ul>

      <h3>Customizing Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/worker-configuration/">Worker Configuration</a></li>
        <li><a href="/user/enterprise/build-images/">Customizing Build Images</a></li>
        <li><a href="/user/enterprise/high-availability/">High Availability</a></li>
        <li><a href="/user/enterprise/custom-queues/">Custom Queues</a></li>
      </ul>

      <h3>Enterprise Operations Manual</h3>
      <ul>
        <li><a href="/user/enterprise/platform-tips/">Platform Administration Tips</a></li>
        <li><a href="/user/enterprise/worker-cli-commands/">Worker Start & Debug Containers</a></li>
        <li><a href="/user/enterprise/ssl-certificate-management/">SSL Certificate Management</a></li>
        <li><a href="/user/enterprise/troubleshooting-guide/">Troubleshooting Guide</a></li>
      </ul>

      <h3>Travis CI Docs</h3>
      <ul>
        <li><a href="/">Travis CI Docs</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page"><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/enterprise/upgrading.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Upgrading Travis CI Enterprise</h1>
          

          
            <div id="toc" class="toc">
              <ul class="list-language">
  <li><a href="#更新travis-ci企业平台">更新Travis CI企业平台</a></li>
  <li><a href="#更新平台上的复制">更新平台上的复制</a></li>
  <li><a href="#更新travis-ci企业工作人员">更新Travis CI企业工作人员</a></li>
  <li><a href="#从备份恢复">从备份恢复</a></li>
  <li><a href="#联系企业支持">联系企业支持</a></li>
</ul>

            </div>
          

          <p>##</p>

<p>在升级之前，我们<strong>强烈推荐</strong>拍摄快照<code class="highlighter-rouge">/etc/travis</code></p>

<p>和<code class="highlighter-rouge">/var/travis</code></p>

<p>一个好方法是运行</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  sudo tar -cvzf travis-backup-$(date +%s).tar.gz /var/travis /etc/travis/

</code></pre></div></div>

<p>看到<a href="#restoring-from-backups">从备份恢复</a>如果您对步骤有任何疑问或想要进行恢复。</p>

<p>###</p>

<p>如果没有加密密钥，则无法访问生产数据库中的信息。要确保始终可以恢复数据库，请备份此密钥。</p>

<blockquote>
  <p>如果没有加密密钥，则数据库中的信息将无法恢复。</p>
</blockquote>

<ol>
  <li>打开与平台机器的ssh连接</li>
  <li>跑<code class="highlighter-rouge">travis bash</code><code class="highlighter-rouge">root</code>权限进入Travis容器。</li>
  <li>然后跑<code class="highlighter-rouge">grep -A1 encryption: /usr/local/travis/etc/travis/config/travis.yml</code>。通过将其写在一张纸上或将其存储在另一台计算机上，创建该命令返回的值的备份。</li>
</ol>

<h2 id="更新travis-ci企业平台">更新Travis CI企业平台 <a href="#更新travis-ci企业平台" class="toc-anchor">#</a></h2>

<p><code class="highlighter-rouge">https://&lt;your-travis-ci-enterprise-domain&gt;:8800</code>然后单击“立即检查”按钮。如果有可用更新，您将能够阅读发行说明并安装更新。</p>

<blockquote>

</blockquote>

<h2 id="更新平台上的复制">更新平台上的复制 <a href="#更新平台上的复制" class="toc-anchor">#</a></h2>

<p>要更新平台安装上的Replicated，您需要运行</p>

<p>安装脚本将下载最新版本。取决于</p>

<p>无论您是在Web代理后面，还是要运行其中一个：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl -sSL -o /tmp/installer.sh https://enterprise.travis-ci.com/install
  sudo bash /tmp/installer.sh

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl -sSL -x http://: -o /tmp/installer.sh https://enterprise.travis-ci.com/install
  sudo bash /tmp/installer.sh http-proxy=http://:

</code></pre></div></div>

<h2 id="更新travis-ci企业工作人员">更新Travis CI企业工作人员 <a href="#更新travis-ci企业工作人员" class="toc-anchor">#</a></h2>

<h3 id="在ubuntu-1604及更高版本上">在Ubuntu 16.04及更高版本上 <a href="#在ubuntu-1604及更高版本上" class="toc-anchor">#</a></h3>

<ol>
  <li>通过编辑Docker标记来配置新图像<code class="highlighter-rouge">/etc/systemd/system/travis-worker.service.d/env.conf</code></li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Service]
Environment="TRAVIS_WORKER_SELF_IMAGE=travisci/worker:v4.6.1"

</code></pre></div></div>

<ol>
  <li>重新加载配置并重新启动服务：</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl daemon-reload
$ sudo systemctl restart travis-worker

</code></pre></div></div>

<h3 id="在ubuntu-1404上">在Ubuntu 14.04上 <a href="#在ubuntu-1404上" class="toc-anchor">#</a></h3>

<p>为了更新Worker，您可以对每个worker执行以下操作</p>

<p>主办：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get update
$ sudo apt-get install travis-worker

</code></pre></div></div>

<h2 id="从备份恢复">从备份恢复 <a href="#从备份恢复" class="toc-anchor">#</a></h2>

<p>如果罕见事件出现问题和/或您想从备份中恢复，请使用以下步骤：</p>

<ol>
  <li>使用全新安装的Ubuntu 14.04启动替换计算机。</li>
  <li>按照中的说明进行操作<a href="/user/enterprise/installation">安装指南</a>。如果你找不到这个，请告诉我们<a href="mailto:enterprise@travis-ci.com">enterprise@travis-ci.com</a></li>
  <li>设置Travis CI实例，根据需要填写设置。填写您保存的RabbitMQ密码和Travis加密密钥。保存设置并启动Travis容器。</li>
  <li>在复制的仪表板中停止Travis CI容器。</li>
  <li>作为超级用户（保留用户权限），解压缩您制作的Travis备份并将目录复制到适当的位置（<code class="highlighter-rouge">/var/travis</code>和<code class="highlighter-rouge">/etc/travis</code>）。</li>
  <li>通过复制仪表板启动Travis CI</li>
</ol>

<p>请注意，这仍然会让您使用最新版本的Travis CI Enterprise。回滚策略需要与Travis CI团队协调，因为它需要将许可证更改回旧版本。</p>

<h2 id="联系企业支持">联系企业支持 <a href="#联系企业支持" class="toc-anchor">#</a></h2>

<p>To get in touch with us, please write a message to 
<a href="mailto:enterprise@travis-ci.com">enterprise@travis-ci.com</a>. If possible, 
please include as much of the following as you can:</p>

<ul>
  <li>Description of the problem - what are you observing?</li>
  <li>Which steps did you try already?</li>
  <li>A support bundle (You can get it from <code class="highlighter-rouge">https://&lt;your-travis-ci-enterprise-domain&gt;:8800/support</code>)</li>
  <li>Log files from all workers (They can be found at <code class="highlighter-rouge">/var/log/upstart/travis-worker.log</code> - please include as many as you can retrieve).</li>
  <li>If a build failed or errored, a text file of the build log</li>
</ul>

<p>Have you made any customizations to your setup? While we may be able to see some 
information (such as hostname, IaaS provider, and license expiration), there 
are many other things we can’t see which could lead to something not working. 
Therefore , we’d like to ask you to also answer the questions below in your 
support request (if applicable):</p>

<ul>
  <li>How many machines are you using?</li>
  <li>Do you use configuration management tools (Chef, Puppet)?</li>
  <li>Which other services do interface with Travis CI Enterprise?</li>
  <li>Do you use Travis CI Enterprise together with github.com or GitHub Enterprise?</li>
  <li>If you’re using GitHub Enterprise, which version of it?</li>
</ul>

<p>We’re looking forward to helping!</p>


        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="layout-inner">
    <div class="footer-elem">
      <svg width="142px" height="45.381px" viewBox="0 0 142 45.381" enable-background="new 0 0 142 45.381" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">
        <title>Travis CI Mascot</title>
        <image xlink:href="https://styleguide.travis-ci.com/images/logos/travis-footer-logo-new.svg" x="0" y="0" width="142px" height="45.381px" />
      </svg>
    </div>

    <div class="footer-elem"></div>

    <div class="footer-elem">
      <h3 class="footer-title">©Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Work with Travis CI</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://changelog.travis-ci.com/">Changelog</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Legal</h3>
      <ul>
        <li><a href="/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="/legal/terms-of-service/">Terms of Service</a></li>
        <li><a href="/legal/refund-policy/">Refund Policy</a></li>
        <li><a href="/legal/data-processing-agreement">Data Processing Agreement</a></li>
        <li><a href="/legal/privacy-policy/">Privacy Policy</a></li>
        <li><a href="/legal/privacy-shield-framework/">Privacy Shield Framework</a></li>
        <li><a href="/legal/security/">Security Statement</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

<script>
 fetch('https://pnpcptp8xh9k.statuspage.io/api/v2/status.json').then(function(response) {
   return response.json();
 }).then(function(data) {
   if (data.status && data.status.indicator) {
     document.querySelector('.status-circle').classList.add(data.status.indicator);
   }
 });
</script>

    </div><!-- /.wrapper -->
  </body>
</html>
