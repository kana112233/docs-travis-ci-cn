<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enterprise Customer Worker Queues - Travis CI</title>
<link rel="stylesheet" href="/docs-travis-ci-cn/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="https://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>

<script src="/docs-travis-ci-cn/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/docs-travis-ci-cn/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body class="enterprise">
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="https://travis-ci.com/" title="Travis CI">Travis</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">About Travis CI Enterprise</a></li>
        <li><a href="/user/enterprise/setting-up-travis-ci-enterprise/">Setting up Travis CI Enterprise</a> </li>
        <li><a href="/user/enterprise/upgrading/">Upgrading</a></li>
      </ul>

      <h3>Environment reference</h3>
      <ul>
        <li><a href="/user/enterprise/xenial">Xenial Build Environment</a></li>

        <li><a href="/user/enterprise/trusty/">Trusty Build Environment</a></li>

        <li><a href="/user/enterprise/precise/">Precise (Legacy) Build Environment</a></li>
      </ul>

      <h3>Customizing Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/worker-configuration/">Worker Configuration</a></li>
        <li><a href="/user/enterprise/build-images/">Customizing Build Images</a></li>
        <li><a href="/user/enterprise/high-availability/">High Availability</a></li>
        <li><a href="/user/enterprise/custom-queues/">Custom Queues</a></li>
      </ul>

      <h3>Enterprise Operations Manual</h3>
      <ul>
        <li><a href="/user/enterprise/platform-tips/">Platform Administration Tips</a></li>
        <li><a href="/user/enterprise/worker-cli-commands/">Worker Start & Debug Containers</a></li>
        <li><a href="/user/enterprise/ssl-certificate-management/">SSL Certificate Management</a></li>
        <li><a href="/user/enterprise/troubleshooting-guide/">Troubleshooting Guide</a></li>
      </ul>

      <h3>Travis CI Docs</h3>
      <ul>
        <li><a href="/">Travis CI Docs</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page"><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/enterprise/custom-queues.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Enterprise Customer Worker Queues</h1>
          

          
            <div id="toc" class="toc">
              <ul class="list-language">
  <li><a href="#在平台上启用队列">在平台上启用队列</a></li>
  <li><a href="#在管理控制台中定义自定义队列">在管理控制台中定义自定义队列</a></li>
  <li><a href="#在workers上定义自定义队列设置">在Workers上定义自定义队列设置</a></li>
  <li><a href="#联系企业支持">联系企业支持</a></li>
</ul>

            </div>
          

          <p>自定义队列为您的团队提供了对特定工作人员的路由作业的更精细控制。这与定制相结合特别有用<a href="/user/enterprise/worker-configuration/">工人配置</a>和/或修改<a href="/user/enterprise/build-images">构建环境</a>。</p>

<p>那里有两个<a href="#enable-queues-on-the-platform">功能标志</a>自定义队列所必需的。设置这些标志后，您可以在中定义队列的配置<a href="#define-custom-queues-in-the-management-console">管理控制台设置</a>，和<a href="#define-custom-queues-settings-on-the-workers">将工作人员分配到新队列</a></p>

<h2 id="在平台上启用队列">在平台上启用队列 <a href="#在平台上启用队列" class="toc-anchor">#</a></h2>

<p>要允许Travis CI Enterprise平台实例将作业路由到自定义队列，请设置<code class="highlighter-rouge">template_selection</code>和<code class="highlighter-rouge">multi_os</code>功能标志。为此，请将ssh导入平台服务器，然后运行<code class="highlighter-rouge">travis console</code>。运行以下命令以启用所需的功能标志：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Travis::Features.enable_for_all(:template_selection); Travis::Features.enable_for_all(:multi_os); exit

</code></pre></div></div>

<p>新设置将立即生效，但在定义新队列之前，作业路由将保持不变。</p>

<h2 id="在管理控制台中定义自定义队列">在管理控制台中定义自定义队列 <a href="#在管理控制台中定义自定义队列" class="toc-anchor">#</a></h2>

<p>为自定义队列启用功能标志后，在管理控制台中配置作业路由。这是在yaml中定义的<strong>**管理控制台底部的部分</strong>**页面，例如<code class="highlighter-rouge">https://&lt;your-travis-ci-enterprise-domain&gt;:8800/settings</code>。</p>

<p>有许多选项/选择器用于定义到自定义队列的路由。回购那场比赛所有将在该自定义队列上构建自定义队列的选择器。我们建议使用以下选择器：</p>

<ul>
  <li><code class="highlighter-rouge">language</code> - 根据项目选择的语言定义构建环境†</li>
  <li><code class="highlighter-rouge">group</code> - 主要是语义的，用于定义环境的“组”†</li>
  <li><code class="highlighter-rouge">owner</code> - 要么是组织，要么是用户</li>
  <li><code class="highlighter-rouge">slug</code> - 存储库，格式如下：<code class="highlighter-rouge">org/repo</code>要么<code class="highlighter-rouge">user/repo</code></li>
</ul>

<p>†指定<code class="highlighter-rouge">language</code>和<code class="highlighter-rouge">group</code>在…的工作<code class="highlighter-rouge">.travis.yml</code><code class="highlighter-rouge">owner</code>，<code class="highlighter-rouge">slug</code>）在配置中。看到<a href="#advanced-configuration-yaml-example">这个例子</a>更多细节。</p>

<blockquote>
  <p>注意：我们不建议使用<code class="highlighter-rouge">dist</code>和<code class="highlighter-rouge">os</code>对于这些选择者。这两个内置了一些自己的路由进程，可能并不完全符合预期。</p>
</blockquote>

<p>按以下格式在“高级配置YAML”中定义选择器：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>production:
  queues:
  - queue: name
    selector: value
  - queue: another.queue
    selector: different_value
    selector: something_else

</code></pre></div></div>

<p>{：data-file =“config / travis.yml”}</p>

<p>见<a href="#advanced-configuration-yaml-example"></a>有关语法的详细信息。准备好后，单击管理控制台设置上的“保存”。 Travis CI Enterprise将使用您的新队列设置重新启动。</p>

<h3 id="高级配置yaml示例">高级配置YAML示例 <a href="#高级配置yaml示例" class="toc-anchor">#</a></h3>

<p>的语法<strong>高级配置YAML</strong>场是非常重要的。语法不正确将导致构建被路由到默认值，通常是a<code class="highlighter-rouge">builds.linux</code>队列，具体取决于您的安装是否有任何修改。以下是自定义队列定义的示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>production:
  queues:
  - queue: builds.ruby
    owner: travis-ci
    language: ruby
    group: enterprise
  - queue: builds.python
    owner: acnagy
    language: python
  - queue: dockercluster
    services:
    - docker
  - queue: legacy
    group: legacy
  - queue: docs
    slug: 'travis-ci/docs-travis-ci-com'

</code></pre></div></div>

<p>{：data-file =“config / travis.yml”}</p>

<p>对于这个例子，构建一个<code class="highlighter-rouge">enterprise</code><code class="highlighter-rouge">travis-ci</code>组织，a<code class="highlighter-rouge">.travis.yml</code>需要看起来如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>group: enterprise
language: ruby
# rest of the yaml, per standard spec

</code></pre></div></div>

<p>{：data-file =“。travis.yml”}</p>

<p><a href="https://github.com/travis-ci/docs-travis-ci-com"><code class="highlighter-rouge">travis-ci/docs-travis-ci.com</code></a>但是，repo不需要任何特殊配置。</p>

<h2 id="在workers上定义自定义队列设置">在Workers上定义自定义队列设置 <a href="#在workers上定义自定义队列设置" class="toc-anchor">#</a></h2>

<p>要将worker分配给特定队列，请定义<code class="highlighter-rouge">QUEUE_NAME</code>worker配置中的变量。它位于<code class="highlighter-rouge">etc/default/travis-worker</code>。更新环境变量以匹配您指定的队列名称<a href="#advanced-configuration-yaml-example">自定义队列配置yaml</a>。然后使用以下命令重启worker：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service travis-worker restart

</code></pre></div></div>

<p>新队列设置将在重新启动时生效。</p>

<h2 id="联系企业支持">联系企业支持 <a href="#联系企业支持" class="toc-anchor">#</a></h2>

<p>To get in touch with us, please write a message to 
<a href="mailto:enterprise@travis-ci.com">enterprise@travis-ci.com</a>. If possible, 
please include as much of the following as you can:</p>

<ul>
  <li>Description of the problem - what are you observing?</li>
  <li>Which steps did you try already?</li>
  <li>A support bundle (You can get it from <code class="highlighter-rouge">https://&lt;your-travis-ci-enterprise-domain&gt;:8800/support</code>)</li>
  <li>Log files from all workers (They can be found at <code class="highlighter-rouge">/var/log/upstart/travis-worker.log</code> - please include as many as you can retrieve).</li>
  <li>If a build failed or errored, a text file of the build log</li>
</ul>

<p>Have you made any customizations to your setup? While we may be able to see some 
information (such as hostname, IaaS provider, and license expiration), there 
are many other things we can’t see which could lead to something not working. 
Therefore , we’d like to ask you to also answer the questions below in your 
support request (if applicable):</p>

<ul>
  <li>How many machines are you using?</li>
  <li>Do you use configuration management tools (Chef, Puppet)?</li>
  <li>Which other services do interface with Travis CI Enterprise?</li>
  <li>Do you use Travis CI Enterprise together with github.com or GitHub Enterprise?</li>
  <li>If you’re using GitHub Enterprise, which version of it?</li>
</ul>

<p>We’re looking forward to helping!</p>


        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="layout-inner">
    <div class="footer-elem">
      <svg width="142px" height="45.381px" viewBox="0 0 142 45.381" enable-background="new 0 0 142 45.381" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">
        <title>Travis CI Mascot</title>
        <image xlink:href="https://styleguide.travis-ci.com/images/logos/travis-footer-logo-new.svg" x="0" y="0" width="142px" height="45.381px" />
      </svg>
    </div>

    <div class="footer-elem"></div>

    <div class="footer-elem">
      <h3 class="footer-title">©Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Work with Travis CI</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://changelog.travis-ci.com/">Changelog</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Legal</h3>
      <ul>
        <li><a href="/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="/legal/terms-of-service/">Terms of Service</a></li>
        <li><a href="/legal/refund-policy/">Refund Policy</a></li>
        <li><a href="/legal/data-processing-agreement">Data Processing Agreement</a></li>
        <li><a href="/legal/privacy-policy/">Privacy Policy</a></li>
        <li><a href="/legal/privacy-shield-framework/">Privacy Shield Framework</a></li>
        <li><a href="/legal/security/">Security Statement</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

<script>
 fetch('https://pnpcptp8xh9k.statuspage.io/api/v2/status.json').then(function(response) {
   return response.json();
 }).then(function(data) {
   if (data.status && data.status.indicator) {
     document.querySelector('.status-circle').classList.add(data.status.indicator);
   }
 });
</script>

    </div><!-- /.wrapper -->
  </body>
</html>
