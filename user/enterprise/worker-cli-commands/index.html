<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enterprise Worker Start & Debug Containers - Travis CI</title>
<link rel="stylesheet" href="/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="https://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>

<script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body class="enterprise">
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="https://travis-ci.com/" title="Travis CI">Travis</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">About Travis CI Enterprise</a></li>
        <li><a href="/user/enterprise/setting-up-travis-ci-enterprise/">Setting up Travis CI Enterprise</a> </li>
        <li><a href="/user/enterprise/upgrading/">Upgrading</a></li>
      </ul>

      <h3>Environment reference</h3>
      <ul>
        <li><a href="/user/enterprise/xenial">Xenial Build Environment</a></li>

        <li><a href="/user/enterprise/trusty/">Trusty Build Environment</a></li>

        <li><a href="/user/enterprise/precise/">Precise (Legacy) Build Environment</a></li>
      </ul>

      <h3>Customizing Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/worker-configuration/">Worker Configuration</a></li>
        <li><a href="/user/enterprise/build-images/">Customizing Build Images</a></li>
        <li><a href="/user/enterprise/high-availability/">High Availability</a></li>
        <li><a href="/user/enterprise/custom-queues/">Custom Queues</a></li>
      </ul>

      <h3>Enterprise Operations Manual</h3>
      <ul>
        <li><a href="/user/enterprise/platform-tips/">Platform Administration Tips</a></li>
        <li><a href="/user/enterprise/worker-cli-commands/">Worker Start & Debug Containers</a></li>
        <li><a href="/user/enterprise/ssl-certificate-management/">SSL Certificate Management</a></li>
        <li><a href="/user/enterprise/troubleshooting-guide/">Troubleshooting Guide</a></li>
      </ul>

      <h3>Travis CI Docs</h3>
      <ul>
        <li><a href="/">Travis CI Docs</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page"><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/enterprise/worker-cli-commands.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Enterprise Worker Start & Debug Containers</h1>
          

          
            <div id="toc" class="toc">
              <ul class="list-language">
  <li><a href="#停止和启动工人">停止和启动工人</a></li>
  <li><a href="#示例工作者停止和启动">示例工作者停止和启动</a></li>
  <li><a href="#启动工作器调试容器">启动工作器调试容器</a></li>
</ul>

            </div>
          

          <h2 id="停止和启动工人">停止和启动工人 <a href="#停止和启动工人" class="toc-anchor">#</a></h2>

<h3 id="用ubuntu-1604作为主机操作系统">用Ubuntu 16.04作为主机操作系统 <a href="#用ubuntu-1604作为主机操作系统" class="toc-anchor">#</a></h3>

<p>Travis CI Worker作为systemd服务安装。以下命令可用于检查状态并启动/停止服务：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl status travis-worker

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl start travis-worker

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl stop travis-worker

</code></pre></div></div>

<h3 id="用ubuntu-1404作为主机操作系统">用Ubuntu 14.04作为主机操作系统 <a href="#用ubuntu-1404作为主机操作系统" class="toc-anchor">#</a></h3>

<p>Travis CI Worker作为一项新兴服务安装。下列</p>

<p>命令可用于检查服务的状态，以及启动或</p>

<p>停下来。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo status travis-worker
travis-worker start/running, process 9622

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo stop travis-worker
travis-worker stop/waiting

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo start travis-worker
travis-worker start/running, process 16339

</code></pre></div></div>

<p>当工人停下来的时候<code class="highlighter-rouge">sudo stop travis-worker</code>它被关闭了</p>

<p>用一个<code class="highlighter-rouge">KILL</code>信号。这将停止所有当前运行的构建作业</p>

<p>并且当工人再次开始时将它们排队。如果你愿意的话</p>

<p>等到成功完成部分或全部工作后，你可以</p>

<p>发出一个<code class="highlighter-rouge">SIGINT</code>代替。这与…一起<code class="highlighter-rouge">sleep</code>确保</p>

<p>至少部分或全部活动作业都可以完成（取决于如何完成）</p>

<p>你的队列很长）。后<code class="highlighter-rouge">sleep</code>完成工人必须</p>

<p>关机通过<code class="highlighter-rouge">sudo stop travis-worker</code>。</p>

<h2 id="示例工作者停止和启动">示例工作者停止和启动 <a href="#示例工作者停止和启动" class="toc-anchor">#</a></h2>

<p>travis-worker根据收到的信号表现不同。比如一个<code class="highlighter-rouge">SIGINT</code>排空队列，它给了travis-worker足够的时间来处理仍在进行中的所有工作，但它不再接受任何新的工作。</p>

<p><code class="highlighter-rouge">SIGKILL</code>另一方面，立即关闭travis-worker并取消所有当前正在运行的作业。如果之后再次启动工作程序，所有先前排队和正在运行的作业将再次重新排队，以便它们像往常一样得到解决。</p>

<h3 id="用ubuntu-1604作为主机操作系统-1">用Ubuntu 16.04作为主机操作系统 <a href="#用ubuntu-1604作为主机操作系统-1" class="toc-anchor">#</a></h3>

<p>使用Ubuntu 16.04作为主机操作系统，travis-works在Docker容器内运行，因此启动和停止工作现在可以通过<code class="highlighter-rouge">systemctl</code>：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl start travis-worker

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl stop travis-worker

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl status travis-worker

</code></pre></div></div>

<p>发送一个<code class="highlighter-rouge">SIGINT</code>信号，请运行以下内容：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker kill -s SIGINT travis-worker

</code></pre></div></div>

<h3 id="用ubuntu-1404作为主机操作系统-1">用Ubuntu 14.04作为主机操作系统 <a href="#用ubuntu-1404作为主机操作系统-1" class="toc-anchor">#</a></h3>

<p>在这个例子中，a<code class="highlighter-rouge">sleep 60</code>用于允许作业在之前完成</p>

<p>工人停了。实际值取决于当前作业队列的时长</p>

<p>是一个工作完成平均需要多长时间，所以你可能希望</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo status travis-worker
travis-worker start/running, process 5671
$ sudo kill -s INT 5671
$ sleep 60
$ sudo status travis-worker
travis-worker start/post-stop, process 9405
$ sudo stop travis-worker

</code></pre></div></div>

<h2 id="启动工作器调试容器">启动工作器调试容器 <a href="#启动工作器调试容器" class="toc-anchor">#</a></h2>

<p>为了在Travis CI Enterprise Worker上启动构建容器</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># start a container and grab the port
id=$(docker -H tcp://0.0.0.0:4243 run -d -p 22 travis:php /sbin/init)
port=$(docker -H tcp://0.0.0.0:4243 port $id 22 | sed 's/.*://')

# ssh into the container (the default password is travis)
ssh travis@localhost -p $port

# stop and remove the container
docker -H tcp://0.0.0.0:4243 kill $id
docker -H tcp://0.0.0.0:4243 rm $id

</code></pre></div></div>

<p>（如果travis-worker在Ubuntu 16.04上运行，<code class="highlighter-rouge">-H tcp://0.0.0.0:4243</code>没有必要了）</p>

<p>##</p>

<p>To get in touch with us, please write a message to 
<a href="mailto:enterprise@travis-ci.com">enterprise@travis-ci.com</a>. If possible, 
please include as much of the following as you can:</p>

<ul>
  <li>Description of the problem - what are you observing?</li>
  <li>Which steps did you try already?</li>
  <li>A support bundle (You can get it from <code class="highlighter-rouge">https://&lt;your-travis-ci-enterprise-domain&gt;:8800/support</code>)</li>
  <li>Log files from all workers (They can be found at <code class="highlighter-rouge">/var/log/upstart/travis-worker.log</code> - please include as many as you can retrieve).</li>
  <li>If a build failed or errored, a text file of the build log</li>
</ul>

<p>Have you made any customizations to your setup? While we may be able to see some 
information (such as hostname, IaaS provider, and license expiration), there 
are many other things we can’t see which could lead to something not working. 
Therefore , we’d like to ask you to also answer the questions below in your 
support request (if applicable):</p>

<ul>
  <li>How many machines are you using?</li>
  <li>Do you use configuration management tools (Chef, Puppet)?</li>
  <li>Which other services do interface with Travis CI Enterprise?</li>
  <li>Do you use Travis CI Enterprise together with github.com or GitHub Enterprise?</li>
  <li>If you’re using GitHub Enterprise, which version of it?</li>
</ul>

<p>We’re looking forward to helping!</p>


        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="layout-inner">
    <div class="footer-elem">
      <svg width="142px" height="45.381px" viewBox="0 0 142 45.381" enable-background="new 0 0 142 45.381" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">
        <title>Travis CI Mascot</title>
        <image xlink:href="https://styleguide.travis-ci.com/images/logos/travis-footer-logo-new.svg" x="0" y="0" width="142px" height="45.381px" />
      </svg>
    </div>

    <div class="footer-elem"></div>

    <div class="footer-elem">
      <h3 class="footer-title">©Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Work with Travis CI</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://changelog.travis-ci.com/">Changelog</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Legal</h3>
      <ul>
        <li><a href="/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="/legal/terms-of-service/">Terms of Service</a></li>
        <li><a href="/legal/refund-policy/">Refund Policy</a></li>
        <li><a href="/legal/data-processing-agreement">Data Processing Agreement</a></li>
        <li><a href="/legal/privacy-policy/">Privacy Policy</a></li>
        <li><a href="/legal/privacy-shield-framework/">Privacy Shield Framework</a></li>
        <li><a href="/legal/security/">Security Statement</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

<script>
 fetch('https://pnpcptp8xh9k.statuspage.io/api/v2/status.json').then(function(response) {
   return response.json();
 }).then(function(data) {
   if (data.status && data.status.indicator) {
     document.querySelector('.status-circle').classList.add(data.status.indicator);
   }
 });
</script>

    </div><!-- /.wrapper -->
  </body>
</html>
